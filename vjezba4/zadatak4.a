CT_CR       EQU 0FFFF0000
CT_LR       EQU 0FFFF0004
CT_IACK     EQU 0FFFF0008
CT_IEND     EQU 0FFFF000C

DMA_SRC     EQU 0FFFF1000
DMA_DEST    EQU 0FFFF1004
DMA_SIZE    EQU 0FFFF1008
DMA_CTRL    EQU 0FFFF100C
DMA_START   EQU 0FFFF1010
DMA_BS      EQU 0FFFF1014

BVJ         EQU 0FFFFFFFC

    MOVE 10000, SP
    JP MAIN

    ORG 0C
    MOVE SR, R6

    ADD R3, 28, R3
    STORE R5, (R3-4)
    
    LOAD R4, (BLOKOVI)
    SUB R4, 1, R4
    STORE R4, (BLOKOVI)

    MOVE 1, R2
    STORE R2, (DMA_BS)

    MOVE R6, SR
    RETN

MAIN
    MOVE 1000, R3
    MOVE -1, R5

    MOVE %D 1000, R0
    STORE R0, (CT_LR)

    MOVE %B 001, R0
    STORE R0, (CT_CR)

NEXT
    MOVE 0, R2

WAIT
    LOAD R0, (CT_IACK)
    CMP R0, 0
    JR_EQ WAIT

    STORE R0, (CT_IACK)

    MOVE BVJ, R0
    STORE R0, (DMA_SRC)

    STORE R3, (DMA_DEST)

    MOVE 9, R0
    STORE R0, (DMA_SIZE)

    MOVE %B 0111, R0
    STORE R0, (DMA_CTRL)

    STORE R0, (DMA_START)
    STORE R0, (CT_IEND)

TRANSFERRING
    CMP R2, 0
    JR_EQ TRANSFERRING

    LOAD R1, (BLOKOVI)
    CMP R1, 0
    JR_NZ NEXT
    
    STORE R1, (CT_CR)
    HALT

BLOKOVI     DW 5
